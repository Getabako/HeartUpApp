# Claude Code Bot セットアップ手順

このリポジトリでは、GitHub IssueにコメントするだけでClaude Code AIが自動でコードを編集してくれるワークフローが設定されています。

## 🚨 セキュリティ上の重要な注意

この方法で生成する**認証トークン**は、あなたのMaxプランのアカウントでログインできる「合鍵」そのものです。

- ❌ **絶対に公開しない**: GitHubのパブリック（公開）リポジトリでは絶対に使用しないでください
- ✅ **プライベートリポジトリでのみ使用**: 必ずプライベートリポジトリでのみ使用してください
- ⚠️ **漏洩したら即無効化**: 万が一トークンが外部に漏れた場合は、Anthropicのアカウント設定でセッションを取り消してください

---

## セットアップ手順

### ステップ1: 認証トークンの生成（手元のPCで実行）

まず、GitHub Actions（無人のロボット）に「あなたのアカウントですよ」と証明させるための「合鍵（OAuthトークン）」を、手元のPCで発行します。

#### 前提条件:
- 手元のPCに `claude-code` CLI がインストールされていること
- `claude-code` CLIで、Maxプランのアカウントにログイン済みであること

#### 手順:

1. **手元のPCでターミナルを開きます**

2. **以下のコマンドを実行します**:
   ```bash
   claude setup-token
   ```

3. **ブラウザが自動で開き、Anthropicの認証画面が表示されます**
   - ログインと承認を求められるので、許可してください

4. **認証が完了すると、ターミナルに `claudecode_oauth_...` から始まる非常に長い文字列（これが認証トークン）が表示されます**

5. **この文字列（トークン）をすべてコピーし、安全な場所に一時的にメモします**

---

### ステップ2: GitHubリポジトリに「合鍵」を登録

次に、自動化したいGitHubリポジトリに、発行した「合鍵（トークン）」を安全に登録します。

1. **自動化したいプライベートリポジトリをGitHubで開きます**

2. **`Settings` タブ → `Secrets and variables` → `Actions` を選択します**

3. **`Repository secrets` のセクションにある `New repository secret` ボタンをクリックします**

4. **以下の2項目を入力します**:
   - **Name**: `CLAUDE_CODE_OAUTH_TOKEN`
     - （この名前は後でYAMLファイルが参照するので、一字一句正確に）
   - **Secret**: ステップ1でコピーした長いトークン文字列 (`claudecode_oauth_...`) を貼り付けます

5. **`Add secret` ボタンを押して保存します**

---

### ステップ3: ワークフローファイルの確認

このリポジトリには既に `.github/workflows/claude_bot.yml` が設定されています。

ファイルの内容を確認したい場合は、以下のパスを参照してください:
```
.github/workflows/claude_bot.yml
```

---

### ステップ4: 動作確認

1. **このリポジトリで、テスト用のIssueを作成します**（例：「テストIssue」）

2. **作成したIssueのコメント欄に、以下のように書き込んで送信します**:
   ```
   @claude README.mdに「こんにちは、世界！」と追記してください。
   ```

3. **リポジトリの `Actions` タブを開きます**

4. **「Claude Code Issue Bot (Max Plan)」というワークフローが実行中（または実行完了）になっていることを確認します**

5. **ワークフローがエラーなく完了すると、数分後に「Claude Code Bot」という名前で新しいコミットがプッシュされ、README.mdが書き換わっているはずです**

---

## 使用方法

Issueのコメントで `@claude` から始めて、実行したいタスクを指示してください:

### 例:
```
@claude バグを修正してください
```

```
@claude 新しい機能を追加してください: ユーザー認証機能
```

```
@claude コードをリファクタリングして、パフォーマンスを改善してください
```

---

## トラブルシューティング

### ワークフローが実行されない場合:
- Issueコメントが `@claude` で始まっているか確認してください
- リポジトリの `Actions` タブでワークフローが有効になっているか確認してください
- `CLAUDE_CODE_OAUTH_TOKEN` シークレットが正しく設定されているか確認してください

### 認証エラーが発生する場合:
- トークンが正しくコピーされているか確認してください
- トークンの有効期限が切れていないか確認してください（必要に応じて再生成）
- Anthropicのアカウントでログインセッションが有効か確認してください

---

## 参考情報

この設定は以下の記事を参考にしています:
https://note.com/el_el_san/n/n502605a9d155
